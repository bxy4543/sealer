# Overview

The nydus project implements a user space filesystem on top of a container image format that improves over the current OCI image specification, in terms of container launching speed, image space, and network bandwidth efficiency, as well as data integrity.See [Nydus](https://github.com/dragonflyoss/image-service).

Nydus can help sealer to improve image distribution performance.

## How to use it

Using existing images that support nydus directly, such as:

```shell
sealer run kubernetes-nydus:v1.19.8 --masters xxx.xxx.xxx.xxx  --passwd xxxxxxx
```

or use it as base image to build anther image.

## How to rebuild it

1. copy nydusdfile dir to /var/lib/sealer

```bash
cp -r nydusdfile /var/lib/sealer
```

2. git clone nydus and buid binary

```bash
cd ~
git clone https://github.com/dragonflyoss/image-service.git
cd image-service
# build nydusd,nydus-images
make fusedev-release
# build nydusdserver
make nydusd-http-server-release
```

3. copy binary to nydusdfile dir

```bash
cp target-nydusdserver/release/nydusdserver  /var/lib/sealer/nydusdfile
cp target-fusedev/release/nydus-image /var/lib/sealer/nydusdfile
cp target-fusedev/release/nydusd /var/lib/sealer/nydusdfile/nydusd_scp_file
```

the final nydusdfile dir is as:

```bash
nydusdfile
├── nydusdimages        # nydus blobs dir
│   └── blobs
├── nydusd_scp_file     # the files need be scp to inodes to start nydusd
│   ├── clean.sh        # nydusd clean
│   ├── httpserver.json # nydusd config file, "host" needs to be modified
│   ├── nydusd          # nydusd,Linux FUSE user-space daemon
│   ├── nydusd.service  # systemd service of nydusd
│   ├── rootfs.meta     # bootstraps generated by nydus-image
│   └── start.sh        # start nydusd rootfs
├── nydusdserver        # nydusd http server
├── nydus-image         # Convert dir into a nydus format container image generating meta part file and data part file respectively
├── README.md
├── Rocket.toml         #Roket config file of nydusd http server
├── serverclean.sh      #nydusd http server clean
└── serverstart.sh      #convert nydus images and start nydusd http server
```

4. modify Metadata

set "NydusFlag":true

5. build new image

```bash
sealer build -t {Your Image Name} -f Kubefile .
```
